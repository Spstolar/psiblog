<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Making Music with pretty_midi | Psi ML</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Making Music with pretty_midi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A minimal example of using markdown with fastpages." />
<meta property="og:description" content="A minimal example of using markdown with fastpages." />
<link rel="canonical" href="http://simonstolarczyk.com/markdown/2020/08/01/Python_and_MIDI.html" />
<meta property="og:url" content="http://simonstolarczyk.com/markdown/2020/08/01/Python_and_MIDI.html" />
<meta property="og:site_name" content="Psi ML" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-01T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Making Music with pretty_midi" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-08-01T00:00:00-05:00","datePublished":"2020-08-01T00:00:00-05:00","description":"A minimal example of using markdown with fastpages.","headline":"Making Music with pretty_midi","mainEntityOfPage":{"@type":"WebPage","@id":"http://simonstolarczyk.com/markdown/2020/08/01/Python_and_MIDI.html"},"url":"http://simonstolarczyk.com/markdown/2020/08/01/Python_and_MIDI.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://simonstolarczyk.com/feed.xml" title="Psi ML" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Psi ML</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Making Music with pretty_midi</h1><p class="page-description">A minimal example of using markdown with fastpages.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-01T00:00:00-05:00" itemprop="datePublished">
        Aug 1, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#making-music-with-pretty_midi">Making Music with pretty_midi</a>
<ul>
<li class="toc-entry toc-h2"><a href="#midi-music">MIDI Music</a></li>
<li class="toc-entry toc-h2"><a href="#creating-midi-files-with-python">Creating MIDI Files with Python</a></li>
</ul>
</li>
</ul><h1 id="making-music-with-pretty_midi">
<a class="anchor" href="#making-music-with-pretty_midi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making Music with pretty_midi</h1>

<h2 id="midi-music">
<a class="anchor" href="#midi-music" aria-hidden="true"><span class="octicon octicon-link"></span></a>MIDI Music</h2>

<p>A while back, when I was first learning Python, a friend and I made a program that generated random music by iterating through a song one note at a time randomly picking the note length and pitch for the notes with increasingly strict rules. My friend figured out how to use <a href="https://pypi.org/project/MIDIUtil/">MIDIUtil</a> to create a midi file by writing down a sequence of note events, where each event says something about:</p>

<ul>
  <li>velocity - how loud the note should be played</li>
  <li>pitch - an integer value for telling a midi play what frequency to play</li>
  <li>note start - when the note should start playing</li>
  <li>note end - when it should stop</li>
</ul>

<p>You can do a lot of music with just that information, and if you make simple choices for notes, with the right MIDI player you can get surprisingly listenable music. I have wanted to expand on this program for a while in various ways:</p>

<ul>
  <li>generating music by applying machine learning techniques to various collections of midi files (like this <a href="https://www.google.com/doodles/celebrating-johann-sebastian-bach">Google Bach doodle</a>)</li>
  <li>making something more interactive (something involving the console where you can add motifs and ideas on the play and have them played back)</li>
  <li>feed the program just a text file with a simplistic music notation to easily create ideas that can get more complex (like <a href="https://tidalcycles.org/index.php/Welcome">TidalCycles</a> which uses Haskell and SuperCollider).</li>
</ul>

<h2 id="creating-midi-files-with-python">
<a class="anchor" href="#creating-midi-files-with-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating MIDI Files with Python</h2>

<p>I searched around on pypi a bit and found a promising package to start writing MIDI files with: <a href="https://pypi.org/project/pretty_midi/">pretty_midi</a>. It’s a <a href="https://github.com/craffel/pretty-midi">project on GitHub</a> that seems to still be active (part of why I am not just using MIDIUtil again is that I remember I slightly annoying setup and it seems to be inactive). After a simple install, and running the second example <a href="http://craffel.github.io/pretty-midi/">from the documentation</a> I found that it easily generated pleasing sounds that (after a bit of fitzing) I could simply listen to with VLC Media Player. Before I just imported the files into Reaper where I could use a custom VST, but this makes iterating a bit quicker.</p>

<p>Here is an example I made where two instruments are playing a very minimalist piece:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pretty_midi</span>

<span class="c1"># Create a PrettyMIDI object
</span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">PrettyMIDI</span><span class="p">()</span>

<span class="c1"># Create an Instrument instance for a cello instrument
</span><span class="n">cello_program</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">instrument_name_to_program</span><span class="p">(</span><span class="s">'Cello'</span><span class="p">)</span>
<span class="n">cello</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">cello_program</span><span class="p">)</span>

<span class="c1"># do the same for a piano
</span><span class="n">piano_program</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">instrument_name_to_program</span><span class="p">(</span><span class="s">'Acoustic Grand Piano'</span><span class="p">)</span>
<span class="n">piano</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="n">piano_program</span><span class="p">)</span>

<span class="c1"># Add the instruments to the PrettyMIDI object
</span><span class="n">ensemble</span><span class="p">.</span><span class="n">instruments</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cello</span><span class="p">)</span>
<span class="n">ensemble</span><span class="p">.</span><span class="n">instruments</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">piano</span><span class="p">)</span>


<span class="n">song_length_in_seconds</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">bpm</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">beat_length</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">bpm</span>
<span class="n">num_beats</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">song_length_in_seconds</span> <span class="o">/</span> <span class="n">beat_length</span><span class="p">)</span>

<span class="k">for</span> <span class="n">beat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_beats</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">beat</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">note_name</span> <span class="o">=</span> <span class="s">'C5'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">note_name</span> <span class="o">=</span> <span class="s">'D5'</span>
    <span class="n">note_number</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">note_name_to_number</span><span class="p">(</span><span class="n">note_name</span><span class="p">)</span>
    <span class="n">note_start</span> <span class="o">=</span> <span class="n">beat</span> <span class="o">*</span> <span class="n">beat_length</span>
    <span class="n">note_end</span> <span class="o">=</span> <span class="n">note_start</span> <span class="o">+</span> <span class="n">beat_length</span>
    <span class="n">note</span> <span class="o">=</span> <span class="n">pretty_midi</span><span class="p">.</span><span class="n">Note</span><span class="p">(</span><span class="n">velocity</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="n">note_number</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">note_start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">note_end</span><span class="p">)</span>
    <span class="n">cello</span><span class="p">.</span><span class="n">notes</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
    <span class="n">piano</span><span class="p">.</span><span class="n">notes</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">write_song</span><span class="p">():</span>
    <span class="c1"># Write out the MIDI data
</span>    <span class="n">ensemble</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'ensemble.mid'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">write_song</span><span class="p">()</span>
</code></pre></div></div>

<p>This is a simple example, yet it shows the basics of the process that I will expand on:</p>

<ul>
  <li>add notes one at a time</li>
  <li>incorporate some randomness into the note properties (here pitch changes deterministically, but that will soon change)</li>
  <li>using multiple instruments</li>
</ul>

<p>I will begin to add to this, hopefully reaching what we achieved during my first experience with Python and MIDI and then think about ways to expand it and then start to apply some of my fastbook reading to it.</p>

  </div><a class="u-url" href="/markdown/2020/08/01/Python_and_MIDI.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog for music, ML, and cheatsheets.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/spstolar" target="_blank" title="spstolar"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/psistolar" target="_blank" title="psistolar"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
