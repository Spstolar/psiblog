<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>DataPlox | Psi ML</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="DataPlox" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A minimal example of using markdown with fastpages." />
<meta property="og:description" content="A minimal example of using markdown with fastpages." />
<link rel="canonical" href="http://simonstolarczyk.com/markdown/2020/07/23/data_objects.html" />
<meta property="og:url" content="http://simonstolarczyk.com/markdown/2020/07/23/data_objects.html" />
<meta property="og:site_name" content="Psi ML" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-23T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="DataPlox" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-07-23T00:00:00-05:00","datePublished":"2020-07-23T00:00:00-05:00","description":"A minimal example of using markdown with fastpages.","headline":"DataPlox","mainEntityOfPage":{"@type":"WebPage","@id":"http://simonstolarczyk.com/markdown/2020/07/23/data_objects.html"},"url":"http://simonstolarczyk.com/markdown/2020/07/23/data_objects.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://simonstolarczyk.com/feed.xml" title="Psi ML" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Psi ML</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/cheatsheet/">Cheatsheet</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">DataPlox</h1><p class="page-description">A minimal example of using markdown with fastpages.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-07-23T00:00:00-05:00" itemprop="datePublished">
        Jul 23, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#markdown">markdown</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#dataplox">DataPlox</a></li>
<li class="toc-entry toc-h1"><a href="#datablock">DataBlock</a></li>
<li class="toc-entry toc-h1"><a href="#dataset">Dataset</a></li>
<li class="toc-entry toc-h1"><a href="#datasets">Datasets</a></li>
<li class="toc-entry toc-h1"><a href="#dataloader">DataLoader</a></li>
<li class="toc-entry toc-h1"><a href="#dataloaders">DataLoaders</a></li>
</ul><h1 id="dataplox">
<a class="anchor" href="#dataplox" aria-hidden="true"><span class="octicon octicon-link"></span></a>DataPlox</h1>

<p>In understanding how to properly feed young, growing models, it is useful to know some of the main data objects in PyTorch and fastai. Fastai extends many of the fundamental PyTorch objects. Here’s the picture that I have in my head:</p>

<p><img src="../../../../images/dataobjects.png" alt="The relationships between important data objects."></p>

<p>For the main PyTorch data classes:</p>

<ul>
  <li><a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset">Dataset</a></li>
  <li><a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader">DataLoader</a></li>
</ul>

<p>The fastai library extends them with:</p>

<ul>
  <li><a href="http://dev.fast.ai/data.core#Datasets">Datasets</a></li>
  <li><a href="https://dev.fast.ai/data.core#DataLoaders">DataLoaders</a></li>
</ul>

<p>and adds a useful class which can help construct the others:</p>

<ul>
  <li><a href="http://dev.fast.ai/data.block#DataBlock">DataBlock</a></li>
</ul>

<h1 id="datablock">
<a class="anchor" href="#datablock" aria-hidden="true"><span class="octicon octicon-link"></span></a>DataBlock</h1>

<p>This is a fastai object <a href="http://dev.fast.ai/data.block">which helps you build Datasets and DataLoaders</a>. In addition to Chapter 6 of the fastbook, there is also <a href="http://dev.fast.ai/tutorial.datablock">a tutorial in the fastai docs</a>. A DataBlock is a blueprint for how to build your data. You tell it:</p>

<ul>
  <li>what kind of data you have (<code class="language-plaintext highlighter-rouge">blocks=</code>),</li>
  <li>how to get the input data (<code class="language-plaintext highlighter-rouge">get_x=</code> or <code class="language-plaintext highlighter-rouge">get_items=</code>),</li>
  <li>how to get the targets/labels (<code class="language-plaintext highlighter-rouge">get_y</code>),</li>
  <li>how to perform the train/validation split (<code class="language-plaintext highlighter-rouge">splitter=</code>),</li>
  <li>as well as any resizing (<code class="language-plaintext highlighter-rouge">items_tfms=</code>) or augmentations you want to be performed (<code class="language-plaintext highlighter-rouge">batch_tfms</code>).</li>
</ul>

<p>By feeding these blue prints a source (like a directory on your computer), you can use a DataBlock to create a Datasets or DataLoaders object.</p>

<h1 id="dataset">
<a class="anchor" href="#dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataset</h1>

<p>Dataset is a Torch object. We can find out exactly what a Dataset is because PyTorch is open source. We just have to be brave enough to parse some of the grittier implementation details.</p>

<p>According to <a href="https://pytorch.org/docs/stable/_modules/torch/utils/data/dataset.html#Dataset">the source code</a> a Dataset is at its core something that allows you to grab an item if you provide the index/key for it and that you can also add items to. This is just the abstract class definition, essentially the bare bones of a what a dataset should be. If you try to make a class that inherits from <code class="language-plaintext highlighter-rouge">Dataset</code> you will get an error if you do not implement <code class="language-plaintext highlighter-rouge">__getitem__</code>, the method for grabbing items. It does this by setting the default behavior of that method to raise a <code class="language-plaintext highlighter-rouge">NotImplementedError</code>. You can also implement this behavior (forcing inheriting classes to define specific methods) by using the <a href="https://docs.python.org/3/library/abc.html">abc package</a>. The source code also mentions that it would have set a default for a length function, but the standard methods for making a default that is forced to change have conflicts with what a length function is “supposed” to do.</p>

<p>The types of Datasets are:</p>

<ul>
  <li>IterableDataset</li>
  <li>TensorDataset</li>
  <li>ConcatDataset</li>
  <li>ChainDataset</li>
  <li>Subset</li>
</ul>

<h1 id="datasets">
<a class="anchor" href="#datasets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Datasets</h1>

<p>Datasets is an object that contains a training Dataset and a validation Dataset. You can generally construct a Datasets object from a DataBlock like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blue_print_details</span><span class="p">)</span>
<span class="n">dsets</span> <span class="o">=</span> <span class="n">dblock</span><span class="p">.</span><span class="n">datasets</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="dataloader">
<a class="anchor" href="#dataloader" aria-hidden="true"><span class="octicon octicon-link"></span></a>DataLoader</h1>

<p>A DataLoader is a Dataset together with a Sampler. A Sampler is a way to create an iterator out of your Dataset, so you can do things like consume data in batches as needed. Rather than take a Dataset an manually loop through chunks of it, at each step using a chunk to update a model, a DataLoader bundles this idea together. This makes a lot of sense to encapsulate: going through your data in batches is a frequently encountered process in machine learning!</p>

<p>We can see <a href="https://pytorch.org/docs/stable/_modules/torch/utils/data/sampler.html#Sampler">from the source code</a> that a Sampler is at minimum:</p>

<ul>
  <li>a way to iterate over indices of dataset elements (<code class="language-plaintext highlighter-rouge">__iter__</code>) and</li>
  <li>a way to calculate the size of the returned iterators (<code class="language-plaintext highlighter-rouge">__len__</code>).</li>
</ul>

<p>Just like with <code class="language-plaintext highlighter-rouge">DataSet</code>, defining the length method is not strictly enforced by the interpreter because the various <code class="language-plaintext highlighter-rouge">NotImplemented</code> errors you can throw do not quite work.`</p>

<p>The kinds of samplers:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">SequentialSampler</code> - go in direct 0, 1, 2, … order.</li>
  <li>
<code class="language-plaintext highlighter-rouge">RandomSampler</code> - randomly choose observations, with or without replacement (<code class="language-plaintext highlighter-rouge">replacement=</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">SubsetRandomSampler</code> - randomly sample from a provided subset of indices, without replacement</li>
  <li>
<code class="language-plaintext highlighter-rouge">WeightedRandomSampler</code> - for non-uniform random sampling</li>
  <li>
<code class="language-plaintext highlighter-rouge">BatchSampler</code> - generate mini-batches of indices</li>
</ul>

<p>For DataLoader, the <a href="https://pytorch.org/docs/stable/_modules/torch/utils/data/dataloader.html#DataLoader">definition is a bit more involved</a>. In part, because it implements multiprocessing, but it also does things like creating a Sampler from the arguments if one wasn’t provided.</p>

<h1 id="dataloaders">
<a class="anchor" href="#dataloaders" aria-hidden="true"><span class="octicon octicon-link"></span></a>DataLoaders</h1>

<p>DataLoaders is an object that contains a training DataLoader and a validation DataLoader. You can construct a DataLoaders from a DataBlock similarly to the Datasets method:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blue_print_details</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="p">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</code></pre></div></div>

  </div><a class="u-url" href="/markdown/2020/07/23/data_objects.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog for music, ML, and cheatsheets.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/spstolar" target="_blank" title="spstolar"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/psistolar" target="_blank" title="psistolar"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
